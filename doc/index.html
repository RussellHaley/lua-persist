<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>lua-persist</title>
    <link rel="stylesheet" href="ldoc.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>lua-persist</h1>


<h2>Contents</h2>
<ul>
<li><a href="#Functions">Functions</a></li>
<li><a href="#Tables">Tables</a></li>
</ul>


<h2>Modules</h2>
<ul class="nowrap">
  <li><strong>persist</strong></li>
</ul>

</div>

<div id="content">

<h1>Module <code>persist</code></h1>
<p>lua-persist.</p>
<p> This is the core library for the Gilead project.
 It provides a wraper around LMDB and provides the following general modules:
 environment - the lmdb environment
 database - a wraper around database functionality
 tracker - a table designed to track changes for persistence
 cursor - not implemented
 index - not implemented</p>


<h2><a href="#Functions">Functions</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#db.open_tx">db.open_tx (self, name, readonly)</a></td>
	<td class="summary">Opens an lmdb transaction.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#db.check_tx">db.check_tx (self, tx)</a></td>
	<td class="summary">Checks the transaction to see if tx is not null and if the transaction flags
 allow for a write to the environment
 NOTE: Does not check the transaction yet.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#db.print_entries">db.print_entries (self)</a></td>
	<td class="summary">Debug function to print the raw entries</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#db.get_keys">db.get_keys (self)</a></td>
	<td class="summary">This funciton is a raw get of all entries in the database
 It could use parameters for fetch size and offset?</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#db.get_all">db.get_all (self)</a></td>
	<td class="summary">This funciton is a raw get of all entries in the database
 It could use parameters for fetch size and offset?</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#db.commit">db.commit (self, tbl)</a></td>
	<td class="summary">Commits values to the database from a table.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#db.search_entries">db.search_entries (self, func, ...)</a></td>
	<td class="summary">Runs a function over each value from the database and
 if it returns true, adds it to the return set.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#db.get_item">db.get_item (self, key)</a></td>
	<td class="summary">Gets a single item from the database</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#db.get_items">db.get_items (self, tbl)</a></td>
	<td class="summary">Searches the database for all the keys in tbl and returns a table of records.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#db.add_items">db.add_items (self, table)</a></td>
	<td class="summary">Adds all entries ina table to the database</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#db.item_exists">db.item_exists (self, key)</a></td>
	<td class="summary">Checks if the database exists.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#db.add_item">db.add_item (self, key, value, tx)</a></td>
	<td class="summary">Use this function to only insert the data if the key is already present and
 duplicates are not allowed.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#db.upsert_item">db.upsert_item (self, key, value)</a></td>
	<td class="summary">Inserts or updates an item in the database</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#db.stats">db.stats (self)</a></td>
	<td class="summary">Returns database statistics including the number of entries</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#env.open_database">env.open_database (self, name, options, create)</a></td>
	<td class="summary">Opens the named k,v database.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#env.stats">env.stats (self)</a></td>
	<td class="summary">Returns the lmdb statistics as a table</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#env.close">env.close (self)</a></td>
	<td class="summary">Closes the environment/files</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#open">open (datadir)</a></td>
	<td class="summary">Open an existing database.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#new">new (datadir, warn)</a></td>
	<td class="summary">Returns a new lmdb environment.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#tracker">tracker (db, t)</a></td>
	<td class="summary">Adds the changes table and the database to the base table specified in t.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#readOnly">readOnly (t)</a></td>
	<td class="summary">Creates a read only table.</td>
	</tr>
</table>
<h2><a href="#Tables">Tables</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#databases">databases</a></td>
	<td class="summary">a table of all the dbs opened for this env.</td>
	</tr>
</table>

<br/>
<br/>


    <h2 class="section-header "><a name="Functions"></a>Functions</h2>

    <dl class="function">
    <dt>
    <a name = "db.open_tx"></a>
    <strong>db.open_tx (self, name, readonly)</strong>
    </dt>
    <dd>
    Opens an lmdb transaction.
 Makes some assumptions about what we need (i.e. MDB.CREATE)


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>



        </li>
        <li><span class="parameter">name</span>



        </li>
        <li><span class="parameter">readonly</span>



        </li>
    </ul>





</dd>
    <dt>
    <a name = "db.check_tx"></a>
    <strong>db.check_tx (self, tx)</strong>
    </dt>
    <dd>
    Checks the transaction to see if tx is not null and if the transaction flags
 allow for a write to the environment
 NOTE: Does not check the transaction yet.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>



        </li>
        <li><span class="parameter">tx</span>



        </li>
    </ul>





</dd>
    <dt>
    <a name = "db.print_entries"></a>
    <strong>db.print_entries (self)</strong>
    </dt>
    <dd>
    Debug function to print the raw entries


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>



        </li>
    </ul>





</dd>
    <dt>
    <a name = "db.get_keys"></a>
    <strong>db.get_keys (self)</strong>
    </dt>
    <dd>
    This funciton is a raw get of all entries in the database
 It could use parameters for fetch size and offset?  I don't
 know how that would be implemented yet


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>



        </li>
    </ul>





</dd>
    <dt>
    <a name = "db.get_all"></a>
    <strong>db.get_all (self)</strong>
    </dt>
    <dd>
    This funciton is a raw get of all entries in the database
 It could use parameters for fetch size and offset?  I don't
 know how that would be implemented yet


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>



        </li>
    </ul>





</dd>
    <dt>
    <a name = "db.commit"></a>
    <strong>db.commit (self, tbl)</strong>
    </dt>
    <dd>
    Commits values to the database from a table.
 If a tracker table was used, only the changes
 (updates/new, delete) are applied to the database.
 otherwise we just puts everything in there (not implemented yet).


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>



        </li>
        <li><span class="parameter">tbl</span>



        </li>
    </ul>





</dd>
    <dt>
    <a name = "db.search_entries"></a>
    <strong>db.search_entries (self, func, ...)</strong>
    </dt>
    <dd>
    Runs a function over each value from the database and
 if it returns true, adds it to the return set.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>



        </li>
        <li><span class="parameter">func</span>



        </li>
        <li><span class="parameter">...</span>



        </li>
    </ul>





</dd>
    <dt>
    <a name = "db.get_item"></a>
    <strong>db.get_item (self, key)</strong>
    </dt>
    <dd>
    Gets a single item from the database


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>



        </li>
        <li><span class="parameter">key</span>



        </li>
    </ul>





</dd>
    <dt>
    <a name = "db.get_items"></a>
    <strong>db.get_items (self, tbl)</strong>
    </dt>
    <dd>
    Searches the database for all the keys in tbl and returns a table of records.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>
         The lp database object
        </li>
        <li><span class="parameter">tbl</span>
         Table containing the keys for searching. The value is ignored.
        </li>
    </ul>





</dd>
    <dt>
    <a name = "db.add_items"></a>
    <strong>db.add_items (self, table)</strong>
    </dt>
    <dd>
    Adds all entries ina table to the database


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>



        </li>
        <li><span class="parameter">table</span>



        </li>
    </ul>





</dd>
    <dt>
    <a name = "db.item_exists"></a>
    <strong>db.item_exists (self, key)</strong>
    </dt>
    <dd>
    Checks if the database exists.  This doesn't work!


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>



        </li>
        <li><span class="parameter">key</span>



        </li>
    </ul>





</dd>
    <dt>
    <a name = "db.add_item"></a>
    <strong>db.add_item (self, key, value, tx)</strong>
    </dt>
    <dd>
    Use this function to only insert the data if the key is already present and
 duplicates are not allowed.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>



        </li>
        <li><span class="parameter">key</span>



        </li>
        <li><span class="parameter">value</span>



        </li>
        <li><span class="parameter">tx</span>



        </li>
    </ul>





</dd>
    <dt>
    <a name = "db.upsert_item"></a>
    <strong>db.upsert_item (self, key, value)</strong>
    </dt>
    <dd>
    Inserts or updates an item in the database


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>



        </li>
        <li><span class="parameter">key</span>



        </li>
        <li><span class="parameter">value</span>



        </li>
    </ul>





</dd>
    <dt>
    <a name = "db.stats"></a>
    <strong>db.stats (self)</strong>
    </dt>
    <dd>
    Returns database statistics including the number of entries


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>



        </li>
    </ul>





</dd>
    <dt>
    <a name = "env.open_database"></a>
    <strong>env.open_database (self, name, options, create)</strong>
    </dt>
    <dd>
    Opens the named k,v database.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>
         The database environment
        </li>
        <li><span class="parameter">name</span>
         The name of the database to open. If the named database does not exist and the <code>create</code> parameter does
 not equate to true, the system asserts.
        </li>
        <li><span class="parameter">options</span>
         table containing lmdb options. NOT IMPLEMENTED YET.
        </li>
        <li><span class="parameter">create</span>
         boolean Specify true if the system should create the database if it does not exist.
        </li>
    </ul>





</dd>
    <dt>
    <a name = "env.stats"></a>
    <strong>env.stats (self)</strong>
    </dt>
    <dd>
    Returns the lmdb statistics as a table


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>



        </li>
    </ul>





</dd>
    <dt>
    <a name = "env.close"></a>
    <strong>env.close (self)</strong>
    </dt>
    <dd>
    Closes the environment/files


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">self</span>



        </li>
    </ul>





</dd>
    <dt>
    <a name = "open"></a>
    <strong>open (datadir)</strong>
    </dt>
    <dd>
    Open an existing database.  Asserts if the data directory does not exist


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">datadir</span>
         Base directory that contains the database files
        </li>
    </ul>





</dd>
    <dt>
    <a name = "new"></a>
    <strong>new (datadir, warn)</strong>
    </dt>
    <dd>
    Returns a new lmdb environment.  This is the base environment/file
 for all databases in your project.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">datadir</span>
         A base directory to find the lmdb files.
        </li>
        <li><span class="parameter">warn</span>
         Throws an error if the database directory already exists
        </li>
    </ul>





</dd>
    <dt>
    <a name = "tracker"></a>
    <strong>tracker (db, t)</strong>
    </dt>
    <dd>
    Adds the changes table and the database to the base table specified in t.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">db</span>
         Will assert if null. Should have check for actual database object.
        </li>
        <li><span class="parameter">t</span>
         Base table for tracking. If t is null a blank table is used.
        </li>
    </ul>





</dd>
    <dt>
    <a name = "readOnly"></a>
    <strong>readOnly (t)</strong>
    </dt>
    <dd>
    Creates a read only table.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">t</span>



        </li>
    </ul>





</dd>
</dl>
    <h2 class="section-header "><a name="Tables"></a>Tables</h2>

    <dl class="function">
    <dt>
    <a name = "databases"></a>
    <strong>databases</strong>
    </dt>
    <dd>
    a table of all the dbs opened for this env.







</dd>
</dl>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/stevedonovan/LDoc">LDoc 1.4.6</a></i>
<i style="float:right;">Last updated 2017-06-17 01:08:19 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
